### Telegram BOT для администрирования группы

Бот написан с использованием библиотеки [pyTelegramBotApi](https://github.com/eternnoir/pyTelegramBotAPI)

- Бот обрабатывает два типа команд:

1. **light_commands**. Команды доступные обычным пользователям
2. **sudo_commands**. Команды доступные только _суперпользователям_. 

Каждой команде должен соответсвовать свой модуль в пакете **views**.

**Пример создания новой light команды для бота:**

1. ```main.py```

    ```light_commands = init_light_command(... 'test') # регистрируем новую команду 'test'```

2. ```views```

    В папке views создаем новый модуль ```test_process.py```. Название модуля может быть любым, но **обязательно
    разделяться нижним подчеркиванием _ и первое слово должно полностью соответствовать имени команды**.
    Хорошим тоном будет придерживаться следующемего именования '_command_process_.py'.
3. ```test_process.py```

    Внутри модуля ```test_process.py``` необходимо создать функцию с аналогичным именем.
    **Важно! Функция должна иметь то же имя, что и содержащий ее модуль**.
    ```test_process.py <- def test_process(): pass```.
 4. Функция принимает на вход два аргумета и возвращает один:
    ```def test_process(message: Message, bot: telebot) -> Message: pass```.
    
    ```message``` - Сообщение от сервера Telegram API. Данное сообщение разбирается и из него
    достаются необходимые данные, такие как:
    
        - id пользователя
        - текст сообщения
        - id сообщения для ответа и так далее
        Подробнее: https://core.telegram.org/bots/api
        
    ```bot``` - экземпляр бота, для отправки сообщения в чат. Экземрляр создается один раз в ```main.py```
    и затем используется в функциях-представлениях.
    
    Функция возвращает ```Message``` - ответ от сервера Telegram.
    
 _Пример функции ```test_process```_
 
 ```python
import telebot
from telebot.types import Message


def test_process(message: Message, bot: telebot) -> Message:
    """Test function"""
    msg = """*Hello world!*"""
    return bot.reply_to(message.reply_to_message, text=msg, parse_mode='markdown',
                        disable_web_page_preview=True)
```

### Примеры использования уже существующих команд:

**Все команды необходимо вводить ответом на сообщение пользователя, которому они предназначаются**

- _информационное сообщение о поиске_
> !web

- _информационное сообщение о флуд группе_
> !flood

- _информационное сообщение о размещение кода_
> !share

- _информационное сообщение с сылками на обучающие материалы_
> !tut

- _информационное сообщение о необходимости расширить вопрос_
> !wq

#### Команды суперпользователей

**Пользователи добавляются в базу**

- _блокировка юзера_
> !ban 0 причина - пользователь блокируется навсегда, но не удаляется из группы и может просматривать сообщения

> !ban 1d 14h 10m причина - пользователь блокируется на 1 день 14 часов 10 минут. Интервал можно указывать частично. Например, только 
минуты и так далее. Так же можно не указывать причину, но команда *!ban* без аргументов будет проигнорирована.

> !ban kick - пользователь удаляется из группы без возможности просмотра сообщений

- _предупреждение пользователя_

> !warn причина - предупреждение пользователя. Если пользователь собрал три предупреждения, то он удаляется из чата

- _добавление или удаление пользователя из группы sudo (суперпользователь)_

**Группа sudo нужна для более гибкого управления участниками, не наделяя их правами администора группы**

> !sudo add - добавить пользователя в группу sudo

> !sudo del - удалить пользователя из группы sudo
>
> !sudoers - получить список sudo пользователей

> **Данное сообщение не предназначается какому-то конкретному пользователю, но так как логика
>  обработки команд подразумевает задавать их ответом на чье либо сообщение, то в данном
>  случае эту команду необхоидмо использовать так же. Не имеет значения на сообщение какого
>  пользователя будет она указана**

Информация о выполненной команде sudo/sudoers приходит от бота в частном сообщении пользователю, который инициировал ее.


## Логирование 
Можно подключить логирование в файле, в котором происходит необходимый для отслеживания запрос.

- Логирование телеграм ответов

```
import logging

logger = telebot.logger
telebot.logger.setLevel(logging.DEBUG)
```

- Логирование работы с базой данных

```logger_peewee = logging.getLogger('peewee')
logger_peewee.addHandler(logging.StreamHandler())
logger_peewee.setLevel(logging.DEBUG)
```

## Создание бота и добавление его в чат телеграм

1. Открывает @BotFather
2. /newbot
3. Даем имя боту, которое будет видимо в чате
4. Задаем уникальное имя боту, aka username. _bot на конце.
5. Получаем API TOKEN KEY.
6. Добавляем в группе участника. Выбираем бота
7. В группе через "Имзменить" переходим в раздел "Администраторы" и добавляем бота администратором.

#### API TOKEN необходимо указать в программе в файле credentials.py.
